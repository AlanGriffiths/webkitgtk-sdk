name: webkitgtk-6-gnome-2204-sdk # you probably want to 'snapcraft register <name>'
base: core22 # the base snap is the execution environment for this snap
version: git # just for humans, typically '1.2+git' or '1.3.2'
summary: Web content engine for GTK(SDK) # 79 char long summary
description: |
  SDK snap for Webkitgtk-6.0+, used with gnome-42-2204 and core22.

grade: stable # must be 'stable' to release into candidate/stable channels
confinement: strict # use 'strict' once you have the right plugs and slots

parts:
  webkitgtk-6-gnome-2204-sdk:
    #source: https://webkitgtk.org/releases/webkitgtk-2.40.1.tar.xz
    source: https://github.com/WebKit/WebKit.git
    source-tag: webkitgtk-2.40.1
    plugin: cmake
    cmake-parameters:
      - -DPORT=GTK
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_INSTALL_PREFIX=/usr
      - -DCMAKE_INSTALL_LIBDIR=lib/$CRAFT_ARCH_TRIPLET
      - -DCMAKE_INSTALL_LIBEXECDIR=lib/$CRAFT_ARCH_TRIPLET
      - -DCMAKE_SKIP_RPATH=ON
      - -DUSE_AVIF=ON
      - -DUSE_GTK4=ON
      - -DENABLE_JOURNALD_LOG=OFF
      - -DENABLE_DOCUMENTATION=OFF
      - -DENABLE_MINIBROWSER=ON
    build-packages:
      - bubblewrap
      - gettext
      - gperf
      - icu-devtools
      - libavif-dev
      - libcairo2-dev
      - libcurl4-gnutls-dev
      - libdav1d-dev
      - libenchant-2-dev
      - libepoxy-dev
      - libfreetype-dev
      - libgcrypt20-dev
      - libghc-text-icu-dev
      - libghc-text-icu-prof
      - libgav1-dev
      - libglx-dev
      - libgstreamer1.0-dev
      - libgstreamer-plugins-bad1.0-dev
      - libgstreamer-plugins-base1.0-dev
      - libgstreamer-plugins-good1.0-dev
      - libgtk-4-dev
      - libharfbuzz-dev
      - libhyphen-dev
      - libicu-dev
      - libicu-le-hb-dev
      - liblcms2-dev
      - libmanette-0.2-dev
      - libnghttp2-dev
      - libopenjp2-7-dev
      - libopengl-dev
      - libpng-dev
      - libsoup-3.0-dev
      - libsecret-1-dev
      - libseccomp-dev
      - libsqlite3-dev
      - libtasn1-6-dev
      - libwebp-dev
      - libwpe-1.0-dev
      - libwpebackend-fdo-1.0-dev
      - libwoff-dev
      - libxcomposite-dev
      - libxdamage-dev
      - libxrender-dev
      - libxslt1-dev
      - libxt-dev
      - ruby-all-dev
      - unifdef
      - xdg-dbus-proxy
      
  deps:
    plugin: nil
    after: [webkitgtk-6-gnome-2204-sdk]
    override-prime: |
      craftctl default
      for PC in $(find . -path "*/pkgconfig/*.pc")
      do
         sed -i '1cprefix=/snap/webkitgtk-6-gnome-2204-sdk/current/usr' $PC
         sed -i 's#libdir=/usr/lib#libdir=${exec_prefix}/lib#' $PC
      done   
    stage-packages:
      - bubblewrap
      - gstreamer1.0-libav
      - libabsl20210324
      - libaom3
      - libatomic1
      - libavif13
      - libdav1d5
      - libelf-dev
      - libenchant-2-2
      - libgav1-0
      - libwpe-1.0-1
      - libwpebackend-fdo-1.0-1
      - libyuv0
    prime:
      - -etc
      - -lib
      - -usr/bin/fc*
      - -usr/bin/gencat
      - -usr/bin/i*
      - -usr/bin/r*
      - -usr/bin/s*
      - -usr/bin/u*
      - -usr/lib/aspell
      - -usr/lib/emacs*
      - -usr/lib/ispell
      - -usr/lib/sys*
      - -usr/lib/*/caca*
      - -usr/lib/*/enchant*
      - -usr/lib/*/gdk*
      - -usr/lib/*/gio
      - -usr/lib/*/gstreamer*
      - -usr/lib/*/libv4l*
      - -usr/lib/*/perl5
      - -usr/lib/*/*/libcrypt.pc
      - -usr/lib/*/*/libnsl.pc
      - -usr/lib/*/*/libtirpc.pc
      - -usr/lib/*/*/libxcrypt.pc
      - -usr/lib/*/*/zlib.pc
      - -usr/lib/pulseaudio
      - -usr/lib/*/crt*
      - -usr/lib/*/gcrt*
      - -usr/lib/*/grcrt*
      - -usr/lib/*/libaa*
      - -usr/lib/*/libanl*
      - -usr/lib/*/libasound*
      - -usr/lib/*/libaspell*
      - -usr/lib/*/libasyncns*
      - -usr/lib/*/libatomic*
      - -usr/lib/*/libavc139*
      - -usr/lib/*/libBroken*
      - -usr/lib/*/libc.a
      - -usr/lib/*/libc.so
      - -usr/lib/*/libca*
      - -usr/lib/*/libcd*
      - -usr/lib/*/libc_non*
      - -usr/lib/*/libcrypt*
      - -usr/lib/*/libdate*
      - -usr/lib/*/libdconf*
      - -usr/lib/*/libdeflate*
      - -usr/lib/*/libdl.a
      - -usr/lib/*/libdv*
      - -usr/lib/*/libdw*
      - -usr/lib/*/libenchant*
      - -usr/lib/*/libepoxy*
      - -usr/lib/*/libfontconf*
      - -usr/lib/*/libfribidi*
      - -usr/lib/*/libgdk*
      - -usr/lib/*/libgomp*
      - -usr/lib/*/libgpm*
      - -usr/lib/*/libgraphite*
      - -usr/lib/*/libgudev*
      - -usr/lib/*/libharf*
      - -usr/lib/*/libhuns*
      - -usr/lib/*/libicu*
      - -usr/lib/*/libiec*
      - -usr/lib/*/libjack*
      - -usr/lib/*/libjbig*
      - -usr/lib/*/libjpeg*
      - -usr/lib/*/libm.a
      - -usr/lib/*/libm.so
      - -usr/lib/*/libm-*
      - -usr/lib/*/libmcheck.a
      - -usr/lib/*/libmp*
      - -usr/lib/*/libmv*
      - -usr/lib/*/libnsl*
      - -usr/lib/*/libnss*
      - -usr/lib/*/libogg*
      - -usr/lib/*/libopenjp*
      - -usr/lib/*/libopus*
      - -usr/lib/*/liborc*
      - -usr/lib/*/libpango*
      - -usr/lib/*/libpixman*
      - -usr/lib/*/libproxy*
      - -usr/lib/*/libps*
      - -usr/lib/*/libpulse*
      - -usr/lib/*/libq*
      - -usr/lib/*/libraw*
      - -usr/lib/*/libre*
      - -usr/lib/*/librom*
      - -usr/lib/*/libsample*
      - -usr/lib/*/libshout*
      - -usr/lib/*/libslang*
      - -usr/lib/*/libsoup*
      - -usr/lib/*/libspeex*
      - -usr/lib/*/libtag*
      - -usr/lib/*/libth*
      - -usr/lib/*/libtiff*
      - -usr/lib/*/libtirp*
      - -usr/lib/*/libtw*
      - -usr/lib/*/libunwind*
      - -usr/lib/*/libvis*
      - -usr/lib/*/libvo*
      - -usr/lib/*/libvpx*
      - -usr/lib/*/libwav*
      - -usr/lib/*/libwayland*
      - -usr/lib/*/libwebp*
      - -usr/lib/*/libX*
      - -usr/lib/*/libxcb*
      - -usr/lib/*/libxkb*
      - -usr/lib/*/libxml*
      - -usr/lib/*/libz.a
      - -usr/lib/*/libz.so
      - -usr/lib/*/*crt*
      - -usr/libexec
      - -usr/sbin
      - -usr/share

